{"componentChunkName":"component---src-templates-post-template-js","path":"/posts/insert-lhfns","result":{"data":{"markdownRemark":{"id":"545d17ac-7252-5d5f-8c02-7a0fbec23975","html":"<p>브랜디 관리자 계정 미로그인 3개월 초과 시 계정을 잠금처리하는 프로세스를 구현했습니다.</p>\n<p>계정의 상태가 잠금으로 변경되거나 잠금 해제가 될 경우에 계정상태 변경이력을 선분으로 기록합니다.</p>\n<p>선분이력은 간단하게</p>\n<ol>\n<li>선분 이력 끊기</li>\n<li>선분 이력 생성</li>\n</ol>\n<p>두가지로 구현할 수 있습니다. 코드는 php로 작성되었습니다.</p>\n<p>먼저 가장 최근의 선분 이력을 불러와서 선분이력 종료 시간을 현재 시간으로 변경합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">updatePrevLh</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$acntNo</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$now</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$params</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span>  <span class=\"token single-quoted-string string\">'\n        UPDATE \n            TB_C_ACCOUNT_LOGIN_STATUS\n        SET\n            LHFNS_DT = ?\n        WHERE \n            C_ACNT_NO = ?\n            AND LHFNS_DT = \\'2037-12-31 23:59:59\\'\n    '</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">array_push</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$params</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$now</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$acntNo</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">commerce_db</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sql</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$params</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>그다음 새로운 선분을 생성합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">insertLh</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$acntNo</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$now</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$regAcntNo</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$params</span> <span class=\"token operator\">=</span> <span class=\"token keyword\">array</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n    <span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">'INSERT INTO TB_C_ACCOUNT_LOGIN_STATUS \n                (C_ACNT_NO, \n                C_ACNT_LOGIN_STTUS_CD, \n                C_ACNT_LOGIN_STTUS_AUTO_YN, \n                LHST_DT, \n                LHFNS_DT, \n                RECD_REG_DT, \n                REG_ACNT_NO)\n            VALUES (?, \\'01\\', \\'N\\', ?, \\'2037-12-31 23:59:59\\', NOW(), ?)'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token function\">array_push</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$params</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$acntNo</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$now</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$regAcntNo</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">commerce_db</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sql</span><span class=\"token punctuation\">,</span> <span class=\"token variable\">$params</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>기존 이력의 선분 종료시점과 새로 생성된 이력의 선분 시작시간이 현재 시간으로 생성됩니다.</p>\n<p>현재 시간은 데이터베이스에서 받아온 후 동일한 값을 updatePrevLh와 insertLh함수에 각각 넘겨줘야 합니다.</p>\n<div class=\"gatsby-highlight\" data-language=\"php\"><pre class=\"language-php\"><code class=\"language-php\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">function</span> <span class=\"token function\">getNowDate</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span>\n<span class=\"token punctuation\">{</span>\n    <span class=\"token variable\">$sql</span> <span class=\"token operator\">=</span> <span class=\"token single-quoted-string string\">' SELECT NOW() AS NOW_DATE'</span><span class=\"token punctuation\">;</span>\n    <span class=\"token keyword\">return</span> <span class=\"token variable\">$this</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">commerce_db</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">query</span><span class=\"token punctuation\">(</span><span class=\"token variable\">$sql</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token function\">row</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token operator\">-</span><span class=\"token operator\">></span><span class=\"token property\">NOW_DATE</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음과같이 쿼리를 작성해서 인자로 넘겨줍니다.</p>","fields":{"slug":"/posts/insert-lhfns","tagSlugs":["/tag/선분이력/"]},"frontmatter":{"date":"2020-06-30T16:05:32.169Z","description":"","tags":["선분이력"],"title":"[API ]선분이력 기록하기","socialImage":"https://i.kym-cdn.com/entries/icons/facebook/000/019/513/til.jpg"}}},"pageContext":{"slug":"/posts/insert-lhfns"}}}